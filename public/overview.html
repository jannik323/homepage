<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Overview:</title><link rel="stylesheet" href="/css/pond.css">
    <script src="/js/pond.js" defer></script>
</head>
<body ondragstart="return false;" ondrop="return false;">
    <main ondragstart="return false;" ondrop="return false;">
        <div id="moveableRoot" ondragstart="return false;" ondrop="return false;">
            <div ondragstart="return false;" ondrop="return false;" class="moveable" style="left:120px; top :20px">
                <h1  id="overviewTitle" ondragstart="return false;" ondrop="return false;" >Games</h1>
            </div>

            <div class="moveable" ondragstart="return false;" ondrop="return false;" style="left:20px; top :30px">
                <a  href="/" ondragstart="return false;" ondrop="return false;">Home</a>
            </div>

            <div id="gameLinks" class="moveable" ondragstart="return false;" ondrop="return false;" style="left:20px; top :120px; width: 600px;height: 800px;">
                <template id="gameLinkTemplate"><div class="moveable" ondragstart="return false;" ondrop="return false;" style="left:20px; top :20px">
                    <a  href="/projects/jarlslice" ondragstart="return false;" ondrop="return false;">Jarlslice</a>
                </div></template>


            </div>
        </div>
    </main>
    <script>
        let categoryName = document.location.pathname.split("/")[2];
        document.title = "Overview: "+categoryName;
        console.log(document.getElementById("overviewTitle"));
        document.getElementById("overviewTitle").innerText =categoryName;

        fetch("/data/projects?category="+categoryName).then(response=>{
            if (!response.ok) {
                console.error(response.status);
                throw new Error("Request failed with status "+response.status);
            }
            return response.json();
        }).then(data=>{

            let gameLinksElement = document.getElementById("gameLinks");

            let gameLinkElementTemplate = document.getElementById("gameLinkTemplate").content.querySelector("div");

            let newlinkpos = 20;

            for (let i = 0; i < data.length; i++) {
                let element = gameLinkElementTemplate.cloneNode(true);
                if(data[i].showcased){
                    element.classList.add("star");
                }
                element.style.opacity="0.8";
                element.querySelector("a").innerText=data[i].name;
                element.querySelector("a").href="/projects/"+data[i].urlName;
                gameLinksElement.appendChild(element);
                initMoveable(element);
                element.moveable.y = newlinkpos;
                newlinkpos+=element.clientHeight+20;
            }

            moveableContainers.push(gameLinksElement.moveable.children);
            gameLinksElement.style.height = (newlinkpos)+"px";

            if(gameLinksElement.clientHeight>700){
                document.getElementById("moveableRoot").style.height=(gameLinksElement.clientHeight+200)+"px";
            }
        })
        .catch(errordata=>console.error(errordata));
    </script>
</body>
</html>